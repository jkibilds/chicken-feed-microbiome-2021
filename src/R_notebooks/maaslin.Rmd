---
title: "R Notebook"
output:
  html_document:
    df_print: paged
---

## Load packages and set the environment

```{r}
#if(!requireNamespace("BiocManager", quietly = TRUE))
#    install.packages("BiocManager")
#BiocManager::install("Maaslin2")
library(Maaslin2)
library(here)
here()
```

## Fit MaAsLin2 finear multivariate model to SRS-normalized, feature table
Taxonomic filter has been applied to remove nonsense taxa. Singletons have been removed and taxonomic information is not present in the input feature table.
```{r, message=FALSE,warning=FALSE,results='hide',fig.keep='all'}
srs_noTax_LogTransform_dose <- Maaslin2(here("results/dadatab-onlysamples-finalFiltered-srs-transp.tsv"),
                     here("data/metadata_samples_Q2_nospaces.tsv"),
                     here("results/MaAsLin2/srs_noTax_LogTransform_dose"),
         fixed_effects = 'dose_mg_per_kg',
         min_abundance = 100,
         min_prevalence = 0.3,
         normalization = "NONE",
         transform = "LOG",
         analysis_method = "LM",
         max_significance = 0.25,
         standardize = TRUE)
```   

```{r, message=FALSE,warning=FALSE,results='hide',fig.keep='all'}
srs_noTax_noTransform_dose <- Maaslin2(here("results/dadatab-onlysamples-finalFiltered-srs-transp.tsv"),
                     here("data/metadata_samples_Q2_nospaces.tsv"),
                     here("results/MaAsLin2/srs_noTax_noTransform_dose"),
         fixed_effects = 'dose_mg_per_kg',
         min_abundance = 100,
         min_prevalence = 0.3,
         normalization = "NONE",
         transform = "NONE",
         analysis_method = "LM",
         max_significance = 0.25,
         standardize = TRUE)
```


```{r, message=FALSE,warning=FALSE,results='hide',fig.keep='all'}
ZINB_srs_noTax_noTransform_dose <- Maaslin2(here("results/dadatab-onlysamples-finalFiltered-srs-transp.tsv"),
                     here("data/metadata_samples_Q2_nospaces.tsv"),
                     here("results/MaAsLin2/ZINB_srs_noTax_noTransform_dose"),
         fixed_effects = 'dose_mg_per_kg',
         min_abundance = 100,
         min_prevalence = 0.3,
         normalization = "NONE",
         transform = "NONE",
         analysis_method = "ZINB",
         max_significance = 0.25,
         standardize = TRUE)
```

```{r, message=FALSE,warning=FALSE,results='hide',fig.keep='all'}
NB_srs_noTax_noTransform_dose <- Maaslin2(here("results/dadatab-onlysamples-finalFiltered-srs-transp.tsv"),
                     here("data/metadata_samples_Q2_nospaces.tsv"),
                     here("results/MaAsLin2/NB_srs_noTax_noTransform_dose"),
         fixed_effects = 'dose_mg_per_kg',
         min_abundance = 100,
         min_prevalence = 0.3,
         normalization = "NONE",
         transform = "NONE",
         analysis_method = "NEGBIN",
         max_significance = 0.25,
         standardize = TRUE)
```

```{r, message=FALSE,warning=FALSE,results='hide',fig.keep='all'}
NB_srs_noTax_LogTransform_dose <- Maaslin2(here("results/dadatab-onlysamples-finalFiltered-srs-transp.tsv"),
                     here("data/metadata_samples_Q2_nospaces.tsv"),
                     here("results/MaAsLin2/NB_srs_noTax_LogTransform_dose"),
         fixed_effects = 'dose_mg_per_kg',
         min_abundance = 100,
         min_prevalence = 0.3,
         normalization = "NONE",
         transform = "LOG",
         analysis_method = "NEGBIN",
         max_significance = 0.25,
         standardize = TRUE)
```

```{r, message=FALSE,warning=FALSE,results='hide',fig.keep='all'}
ZINB_srs_noTax_LogTransform_dose <- Maaslin2(here("results/dadatab-onlysamples-finalFiltered-srs-transp.tsv"),
                     here("data/metadata_samples_Q2_nospaces.tsv"),
                     here("results/MaAsLin2/ZINB_srs_noTax_LogTransform_dose"),
         fixed_effects = 'dose_mg_per_kg',
         min_abundance = 100,
         min_prevalence = 0.3,
         normalization = "NONE",
         transform = "LOG",
         analysis_method = "ZINB",
         max_significance = 0.25,
         standardize = TRUE)
```

## Fit MaAsLin2 finear multivariate model to non-normalized, feature table
Taxonomic filter has been applied to remove nonsense taxa. Singletons have been removed and taxonomic information is not present in the input feature table.
```{r, message=FALSE,warning=FALSE,results='hide',fig.keep='all'}
clr_noTax_LogTransform_dose <- Maaslin2(here("results/dadatab-onlysamples-finalFiltered-transp.tsv"),
                     here("data/metadata_samples_Q2_nospaces.tsv"),
                     here("results/MaAsLin2/clr_noTax_LogTransform_dose"),
         fixed_effects = 'dose_mg_per_kg',
         min_abundance = 100,
         min_prevalence = 0.3,
         normalization = "CLR",
         transform = "LOG",
         analysis_method = "LM",
         max_significance = 0.25,
         standardize = TRUE)
```   

```{r, message=FALSE,warning=FALSE,results='hide',fig.keep='all'}
clr_noTax_noTransform_dose <- Maaslin2(here("results/dadatab-onlysamples-finalFiltered-transp.tsv"),
                     here("data/metadata_samples_Q2_nospaces.tsv"),
                     here("results/MaAsLin2/clr_noTax_noTransform_dose"),
         fixed_effects = 'dose_mg_per_kg',
         min_abundance = 100,
         min_prevalence = 0.3,
         normalization = "CLR",
         transform = "NONE",
         analysis_method = "LM",
         max_significance = 0.25,
         standardize = TRUE)
``` 

```{r, message=FALSE,warning=FALSE,results='hide',fig.keep='all'}
NB_clr_noTax_noTransform_dose <- Maaslin2(here("results/dadatab-onlysamples-finalFiltered-transp.tsv"),
                     here("data/metadata_samples_Q2_nospaces.tsv"),
                     here("results/MaAsLin2/NB_clr_noTax_noTransform_dose"),
         fixed_effects = 'dose_mg_per_kg',
         min_abundance = 100,
         min_prevalence = 0.3,
         normalization = "CLR",
         transform = "NONE",
         analysis_method = "NEGBIN",
         max_significance = 0.25,
         standardize = TRUE)
```

```{r, message=FALSE,warning=FALSE,results='hide',fig.keep='all'}
ZINB_clr_noTax_noTransform_dose <- Maaslin2(here("results/dadatab-onlysamples-finalFiltered-transp.tsv"),
                     here("data/metadata_samples_Q2_nospaces.tsv"),
                     here("results/MaAsLin2/ZINB_clr_noTax_noTransform_dose"),
         fixed_effects = 'dose_mg_per_kg',
         min_abundance = 100,
         min_prevalence = 0.3,
         normalization = "CLR",
         transform = "NONE",
         analysis_method = "ZINB",
         max_significance = 0.25,
         standardize = TRUE)
```

